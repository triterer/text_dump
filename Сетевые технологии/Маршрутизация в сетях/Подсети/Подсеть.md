 Подсеть
========================

логическое разделение сети IP.

IP-адрес разделён [маской подсети](%D0%9F%D0%BE%D0%B4%D1%81%D0%B5%D1%82%D0%B8%2F%D0%9C%D0%B0%D1%81%D0%BA%D0%B0%20%D0%BF%D0%BE%D0%B4%D1%81%D0%B5%D1%82%D0%B8.md) на префикс сети и адрес хоста. Хостом в данном случае является любое сетевое устройство (а именно сетевой интерфейс этого устройства), обладающее IP-адресом. Компьютеры, входящие в одну подсеть, принадлежат одному диапазону IP-адресов.

Преимущества подсетей заключается в более эффективном использовании доступных адресов. 

## Планирование подсетей
### Определение префикса сети
Маска подсети в IPv4 состоит из 32 битов, непрерывной последовательности единиц (1), за которой следует непрерывная последовательность нулей (0). В маске подсети не может стоять единица после нуля. 

|  | Двоичная форма | Точечно-десятичная нотация  |
|---|---|---|
| IP-адрес  | 11000000.10101000.00000101.10000010 | 192.168.5.130 |
| [Маска подсети](%D0%9F%D0%BE%D0%B4%D1%81%D0%B5%D1%82%D0%B8%2F%D0%9C%D0%B0%D1%81%D0%BA%D0%B0%20%D0%BF%D0%BE%D0%B4%D1%81%D0%B5%D1%82%D0%B8.md)  | *11111111.11111111.11111111*.00000000 | 255.255.255.0 |
| Сетевой префикс  | 11000000.10101000.00000101.00000000 | 192.168.5.0 |
| Адрес хоста (часть IP) | 00000000.00000000.00000000.10000010 | 0.0.0.130 |

Сетевой префикс (адрес сети) вычисляется побитовой операцией AND между IP-адресом и маской. Результат AND равен единице тогда, когда оба операнда равны единице. 

### Подсчёт количества подсетей
Общая формула:  $N = 2^n$ , где N — количество подсетей, а n — маска сети в нотации CIDR делённая по модулю 8 (или просто количество добавленных бит к маске). 
Создание подсетей предполагает увеличение маски сети на несколько бит. 

|  | Двоичная форма | Точечно-десятичная нотация  |
|---|---|---|
| IP-адрес  | 11000000.10101000.00000101.10000010 | 192.168.5.130 |
| Маска подсети  | *11111111.11111111.11111111*.**1**0000000 | 255.255.255.192 |
| Сетевой префикс  | 11000000.10101000.00000101.00000000 | 192.168.5.0 |
| Адрес хоста (часть IP) | 00000000.00000000.00000000.10000010 | 0.0.0.130 |

В примере выше маска подсети была увеличена на 1 бит, создавая тем самым 4 = $ 2^{1}$ возможных подсетей: 

| Сеть  | Сеть (двоичный) |   Широковещательный адрес  |
|---|---|---|
| 192.168.5.0/26  | 11000000.10101000.00000101.**00**000000 | 192.168.5.63 |
| 192.168.5.64/26  | 11000000.10101000.00000101.**01**000000 | 192.168.5.127 |
| 192.168.5.128/26  | 11000000.10101000.00000101.**10**000000 | 192.168.5.191 |
| 192.168.5.192/26 | 11000000.10101000.00000101.**11**000000 | 192.168.5.255 |

 У нас есть адрес сети 192.168.1.0/24, нам надо разделить имеющуюся сеть на 2 подсети. Попробуем забрать от порции хоста 1 бит и воспользоваться формулой: 2^1=2, это значит, что если мы заберём один бит от части хоста, то мы получим 2 подсети. Присвоение одного бита из порции хоста увеличит префикс на один бит: /25. Теперь надо выписать 2 одинаковых IP адреса сети в двоичном виде изменив только присвоенный бит (у первой подсети присвоенный бит будет равен 0, а у второй подсети = 1). Захваченный бит я выделю более жирным шрифтом цвета.
 
2 подсети (захваченный бит я выделю более жирным шрифтом красного цвета):
1. 11000000.10101000.00000001.**0**0000000
2. 11000000.10101000.00000001.**1**0000000

Теперь запишем рядом с двоичным видом десятичный, и добавим новый префикс. Жирным пометил порцию подсети, а курсивом – порцию хоста.
1. **11000000.10101000.00000001.0***0000000* = 192.168.1.0/25
2. **11000000.10101000.00000001.1***0000000* = 192.168.1.128/25

Всё, сеть разделена на 2 подсети. Как мы видим выше, порция хоста теперь составляет 7 бит.
Чтобы высчитать, сколько адресов хостов можно получить используя 7 бит, необходимо воспользоваться cisco формулой расчёта хостов: $2^n - 2$, где n = количество бит в порции хоста.

2^7 - 2 = 126 хостов. В начале статьи было сказано, что вычитаемая цифра 2 является двумя адресами, которые нельзя присвоить хосту: адрес сети и широковещательный адрес.

Адрес сети, это когда в порции хоста все нули, а широковещательный адрес, это когда в порции хоста все единицы. Выпишем эти адреса для каждой подсети в двоичном и десятичном виде:
**11000000.10101000.00000001.0***0000000* = 192.168.1.0/25 (адрес сети первой подсети)
**11000000.10101000.00000001.0***1111111* = 192.168.1.127/25 (широковещательный адрес первой подсети)
**11000000.10101000.00000001.1***0000000* = 192.168.1.128/25 (адрес сети второй подсети)
**11000000.10101000.00000001.1***1111111* = 192.168.1.255/25 (широковещательный адрес второй подсети) 



### Подсчёт количества адресов для хостов в подсети
Количество возможных хостов в сети могут быть легко вычислены по формуле $2^n - 2$. Биты маски подсети, равные нулю, отведены под адреса хостов. 

Значения из одних нулей и значения из одних единиц зарезервированы для адреса сети и широковещательного адреса соответственно. Или другими словами первый и последний адрес подсети. Поэтому при подсчёте числа хостов надо вычитать 2 из общего числа доступных адресов. 

Например, для маски /27 могут использоваться 8 подсетей. Каждый первый IP-адрес в подсети (.0, .32, .64, …, .224), то есть адрес сети, и каждый последний IP-адрес в подсети (.31, .63, .95, … .255), то есть широковещательный адрес, зарезервированы, соответственно для каждой сети доступно только 30 адресов (c .1 по .30, с .33 по .62, с.65 по .94, … с .225 по .254).

/24 сеть может быть разделена на следующие подсети увеличением маски подсети последовательно по одному биту. Длина маски влияет на общее количество хостов, которые могут быть определены в сети (последний столбец). 